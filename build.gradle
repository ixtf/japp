plugins {
    id "idea"
    id "maven"
    id "maven-publish"
    id "io.spring.dependency-management" version "1.0.9.RELEASE" apply false
    id "io.freefair.lombok" version "5.1.0" apply false
    id "com.github.johnrengelman.shadow" version "6.0.0" apply false
    id "com.palantir.docker" version "0.25.0" apply false
    id "com.google.protobuf" version "0.8.12" apply false
}

subprojects {
    group "com.github.ixtf.japp"
    version "1.6.5"

    apply plugin: "idea"
    apply plugin: "maven"
    apply plugin: "maven-publish"
    apply plugin: "java"
    apply plugin: "io.spring.dependency-management"
    apply plugin: "io.freefair.lombok"

    sourceCompatibility = 11
    targetCompatibility = 11

    repositories {
        mavenLocal()
        mavenCentral()
        maven { url 'https://plugins.gradle.org/m2' }
        maven { url 'https://jitpack.io' }
    }

    dependencyManagement {
        imports {
            mavenBom "com.github.ixtf:bom:${bomVersion}"
        }
    }
}
subprojects {
    apply plugin: 'java'
    sourceCompatibility = 11
    targetCompatibility = 11

    dependencies {
        compile "org.apache.commons:commons-lang3",
                "org.apache.commons:commons-text",
                "org.apache.commons:commons-collections4",
                "commons-io:commons-io",
                "io.github.classgraph:classgraph",
                "com.github.ben-manes.caffeine:caffeine",
                "com.google.guava:guava",
                "ch.qos.logback:logback-classic",
                "ch.qos.logback:logback-access",
                "org.hibernate.validator:hibernate-validator",
                "org.glassfish:jakarta.el",
                "com.fasterxml.jackson.core:jackson-databind",
                "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml",
                "com.fasterxml.jackson.datatype:jackson-datatype-jdk8",
                "com.fasterxml.jackson.datatype:jackson-datatype-jsr310",
                "com.fasterxml.jackson.module:jackson-module-parameter-names"

        compileOnly "io.vertx:vertx-codegen"

        testCompile "junit:junit",
                "io.vertx:vertx-unit",
                "io.vertx:vertx-web-client"
    }

    jar.manifest {
        attributes(
                'Implementation-Title': name,
                'Implementation-Version': version,
                'Built-By': System.getProperty('user.name'),
                'Built-JDK': System.getProperty('java.version'),
                'Source-Compatibility': sourceCompatibility,
                'Target-Compatibility': targetCompatibility
        )
    }

    java {
        withJavadocJar()
        withSourcesJar()
    }
    artifacts {
        archives javadocJar, sourcesJar
    }
//    [compileJava, compileTestJava].each() {
////        it.options.compilerArgs += ["-Xlint:all", "-Xlint:-options", "-Xlint:-path"]
//        it.options.encoding = "UTF-8"
//        if (rootProject.hasProperty('failOnWarnings') && rootProject.failOnWarnings.toBoolean()) {
//            it.options.compilerArgs += ["-Werror"]
//        }
//    }
//    compileTestJava {
//        // serialVersionUID is basically guaranteed to be useless in our tests
//        options.compilerArgs += ["-Xlint:-serial"]
//    }
//    javadoc.options {
//        encoding = 'UTF-8'
//        use = true
//        links 'https://docs.oracle.com/javase/8/docs/api/'
//    }
//    task javadocJar(type: Jar) {
//        classifier = 'javadoc'
//        from javadoc
//    }
//    task sourcesJar(type: Jar) {
//        classifier = 'sources'
//        from sourceSets.main.allSource
//    }

}
